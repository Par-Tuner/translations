# 像 1983 年那样学习 BASIC

*2018 年 9 月 2 日*

1983 年的时候，我还没有出生。这偶尔会让我感到遗憾。我尤其遗憾的是，没有亲身经历 8 位计算机 (8-bit computer) 时代，因为我认为那些在计算机相对简单和受限时首次接触它们的人，比我们其他人拥有巨大的优势。

如今，几乎每个人都知道如何使用计算机，但即使在计算机行业中，也很少有人能完全理解任何一台机器内部的运作。现在有 [如此多的软件层](https://www.youtube.com/watch?v=kZRE7HIO3vk) 在做着如此多不同的事情，以至于人们很难分辨出哪些部分是必不可少的。然而在 1983 年，家用计算机足够简单，一个勤奋的人可以彻彻底底地了解一台特定计算机的工作原理。那个人今天可能比我更不困惑于现代操作系统在硬件之上堆叠的各种抽象层。我预计这些抽象层在它们被引入时，逐一理解起来很容易；而如今，新程序员必须自上而下、逆时间顺序地去理解所有这些抽象层。

许多著名的程序员，尤其是在电子游戏行业，都是在童年时期从苹果 II (Apple II) 和康懋达 64 (Commodore 64) 等 8 位计算机上开始编程游戏的。John Romero、Richard Garriott 和 Chris Roberts 都是其中的例子。这很容易理解。在 8 位计算机时代，许多游戏只能以印刷的 BASIC 程序列表形式出现在计算机杂志和 [书籍](https://en.wikipedia.org/wiki/BASIC_Computer_Games) 中。如果你想玩其中一款游戏，就必须手动输入整个程序。不可避免地，你会输入错误，所以你必须调试你的程序。等你把它弄好并运行起来时，你已经对程序的功能有了足够的了解，可以开始自己修改它了。如果你是一个狂热的游戏玩家，你几乎是必然地成为了优秀的程序员。

我的童年也玩计算机游戏。但我玩的游戏都装在光盘 (CD-ROM) 上。我有时会发现自己不得不谷歌如何修复一个崩溃的安装程序，这可能涉及编辑 Windows 注册表 (Windows Registry) 或类似的操作。这种小故障排除可能让我对计算机足够熟悉，以至于考虑在大学学习计算机科学 (Computer Science)。但它从未教会我任何关于计算机如何工作或如何控制它们的关键知识。

当然，现在我以指挥计算机为生。即便如此，我还是忍不住觉得，我错过了一些只有那些从小编程简单计算机的人才能获得的基本见解。在 20 世纪 80 年代初第一次接触计算机是什么感觉？那与今天使用计算机的体验会有什么不同？

这篇文章将与 Two-Bit History 的常规文章有所不同，因为我将尝试设想一个这些问题的答案。

## 1983

就在上周，你在电视上看到了 [康懋达 64 的广告](https://www.youtube.com/watch?v=ZekAbt2o6Ms)。既然《陆军野战医院》 (M\*A\*S\*H) 已经结束了，你正在寻找新的事情在周一晚上做。这个康懋达 64 看起来甚至比 Rudy 家地下室的苹果 II 还要好。而且，广告承诺这台新电脑很快就会让朋友们“挤破”你的门槛。你知道学校里有几个人宁愿在你家玩，也不愿去 Rudy 家，只要他们能在你家玩 *Zork*。

所以你父母被你说服买了一台。你妈妈说，只有当家里有了电脑意味着你远离街机厅时，他们才会考虑。你勉强同意了。你爸爸觉得他会用他听说过的电子表格程序 MultiPlan (MultiPlan) 来记录家庭财务，这就是为什么电脑被放在客厅的原因。然而一年后，你将是唯一还在使用它的人。你终于被允许把它放在你卧室的桌子上，就在你的 Police 乐队海报下面。

(你的妹妹对此表示抗议，但那是 1983 年，计算机 [还不是为她准备的](https://www.npr.org/sections/money/2014/10/21/357629765/when-women-stopped-coding)。)

爸爸下班回家路上从 [ComputerLand](https://www.youtube.com/watch?v=MA_XtT3VAVM) 把电脑取了回来。你们俩把盒子放在电视旁边打开。“欢迎来到友好计算的世界，”包装上写道。二十分钟后，你俩并不信服——你们还在努力将康懋达连接到电视机上，并想知道电视天线电缆是 75 欧姆还是 300 欧姆的同轴电缆。但最终你们还是成功地将电视调到 3 频道，看到了一个颗粒感十足的紫色画面。

![Commodore 64 startup screen](https://twobithistory.org/images/c64_startup.png)

图 1: 康懋达 64 启动画面

电脑报告说 `READY`。你爸爸把电脑推向你，示意你先试一试。你小心翼翼地寻找每个字母，输入了 `HELLO`。电脑的反应令人困惑。

![Commodore 64 syntax error](https://twobithistory.org/images/c64_error.png)

图 2: 康懋达 64 语法错误

你尝试输入了几个不同的单词，但反应总是相同的。你爸爸说你最好把剩下的手册读完。这绝非易事——[康懋达 64 附带的手册](ftp://www.zimmers.net/pub/cbm/c64/manuals/C64_Users_Guide.pdf) 是一本小册子。但这并没有困扰你，因为手册的引言预示着奇迹。

它声称，康懋达 64 拥有“微型计算机行业中最先进的图像制作器”，这将允许你“用四种不同的颜色设计自己的图片，就像你在街机式视频游戏中看到的那样。”康懋达 64 还拥有“内置的音乐和音效，可与许多知名音乐合成器媲美。”所有这些工具都将交到你手中，因为手册会一步步引导你：

> 就像所有可用的硬件一样重要的是，本用户指南 (USER’S GUIDE) 将帮助你培养对计算机的理解。它不会告诉你关于计算机的一切，但它会向你推荐各种出版物，以获取关于所介绍主题的更详细信息。康懋达希望你真正享受你的新康懋达 64。为了玩得开心，请记住：编程不是一天就能学会的事情。在阅读用户指南时，请对自己要有耐心。

那天晚上，在床上，你读完了前三章——“设置”、“入门”和“BASIC 编程入门”——最终手册摊开在胸前，抵挡不住睡意。

## Commodore BASIC

现在是周六早上，你迫不及待地想尝试所学到的东西。手册教你的第一件事就是如何改变显示屏上的颜色。你按照说明操作，按下 `CTRL-9` 进入反向显示模式，然后按住空格键创建长行。你使用 `CTRL-1` 到 `CTRL-8` 切换颜色，陶醉于你突然获得的对电视屏幕的掌控力。

![Commodore 64 color bands](https://twobithistory.org/images/c64_colors.png)

图 3: 康懋达 64 彩色条纹

尽管这很酷，但你意识到这不算编程。为了编程计算机，你昨晚学到，你必须用一种叫做 BASIC 的语言与它对话。对你来说，BASIC 像是《星球大战》里的东西，但 BASIC 到 1983 年已经将近二十年历史了。它是由达特茅斯学院的两位教授 John Kemeny 和 Tom Kurtz 发明的，他们希望让社会科学和人文学科的本科生也能接触到计算机。它在小型计算机上广泛使用，并在大学数学课上很受欢迎。后来，在 Bill Gates 和 Paul Allen 为牵牛星 (Altair) 编写了微软 (MicroSoft) BASIC 解释器 (BASIC interpreter) 后，它在微型计算机上成为标准。但手册没有解释这些，你很多年以后才会了解到。

手册建议你尝试的第一个 BASIC 命令是 `PRINT` 命令 (PRINT command)。你慢慢地输入 `PRINT "COMMODORE 64"`，因为你花了一段时间才找到 `2` 键上方的引号符号。你按下 `RETURN`，这次，电脑没有抱怨，而是完全按照你说的做了，在下一行显示了“COMMODORE 64”。

现在你尝试对各种不同的东西使用 `PRINT` 命令：两个数字相加，两个数字相乘，甚至几个小数。你不再输入 `PRINT`，而是使用 `?`，因为手册告诉你 `?` 是 `PRINT` 的缩写，专家级程序员经常使用。你觉得自己已经像个专家了，但你又想起你甚至还没到第三章，“BASIC 编程入门。”

你很快就到了那里。这一章首先提示你编写你的第一个真正的 BASIC 程序。你输入 `NEW` 并按下 `RETURN`，这给了你一个干净的开始。然后你输入你的程序：

```
10 ?"COMMODORE 64"
20 GOTO 10
```

手册解释说，10 和 20 是行号。它们为计算机排列语句。它们还允许程序员在某些命令中引用程序的其他行，就像你在这里使用 `GOTO` 命令 (GOTO command) 所做的那样，它将程序导回第 10 行。手册认为，“以 10 为增量给行编号是一个良好的编程习惯——以防你以后需要插入一些语句。”

你输入 `RUN`，然后盯着屏幕，屏幕上反复出现“COMMODORE 64”，直到屏幕被占满。

![Commodore 64 showing result of printing "Commodore 64"
repeatedly](https://twobithistory.org/images/c64_print_loop.png)

图 4: 康懋达 64 反复打印“Commodore 64”的结果

你不确定这会不会炸毁你的电脑。你花了一秒钟才想起你应该按下 `RUN/STOP` 键 (RUN/STOP key) 来中断循环。

手册接下来的几节教你关于变量 (variables) 的知识，手册告诉你变量就像“计算机内部的许多盒子，每个盒子都可以容纳一个数字或一串文本字符。”以 `%` 符号结尾的变量是整数，而以 `$` 符号结尾的变量是字符串。所有其他变量都是所谓的“浮点数 (floating point)”变量。手册警告你要小心变量名，因为计算机实际上只识别名称的前两个字母，尽管没有什么能阻止你把名字取得尽可能长。（这并没有特别困扰你，但你可以想象 30 年后这可能会让某人觉得完全不可思议。）

然后你学习了 `IF... THEN...` (IF...THEN...) 和 `FOR... NEXT...` (FOR...NEXT...) 结构。有了所有这些新工具，你觉得自己有能力应对手册抛出的下一个大挑战。它诱惑道：“如果你是那种有抱负的人，输入以下程序，看看会发生什么。”这个程序比你目前见过的任何程序都更长、更复杂，但你非常想知道它会做什么：

```
10  REM BOUNCING BALL
20  PRINT "{CLR/HOME}"
25  FOR X = 1 TO 10 : PRINT "{CRSR/DOWN}" : NEXT
30  FOR BL = 1 TO 40
40  PRINT " ●{CRSR LEFT}";:REM (● is a Shift-Q)
50  FOR TM = 1 TO 5
60  NEXT TM
70  NEXT BL
75  REM MOVE BALL RIGHT TO LEFT
80  FOR BL = 40 TO 1 STEP -1
90  PRINT " {CRSR LEFT}{CRSR LEFT}●{CRSR LEFT}";
100 FOR TM = 1 TO 5
110 NEXT TM
120 NEXT BL
130 GOTO 20
```

上面的程序利用了康懋达 64 最酷的功能之一。不可打印命令字符 (Non-printable command characters) 在作为字符串的一部分传递给 `PRINT` 命令时，会执行它们通常执行的操作，而不是打印到屏幕上。这允许你通过在程序中打印字符串来重放任意命令链。

你花了很长时间才输入完上面的程序。你犯了几个错误，不得不重新输入一些行。但最终你成功输入 `RUN`，并看到了一个杰作：

![Commodore 64 bouncing ball](https://twobithistory.org/images/c64_ball.gif)

图 5: 康懋达 64 弹跳球

你认为这可能是你见过的最酷的东西之一。然而你几乎立刻就把它忘了，因为一旦你了解了 BASIC 的内置函数，比如 `RND` (随机数函数) (它返回一个随机数) 和 `CHR$` (字符函数) (它返回与给定数字代码匹配的字符)，手册就向你展示了一个程序，多年以后它仍然足够有名，甚至成为一本 [散文选集](http://10print.org/) 的标题：

```
10 PRINT "{CLR/HOME}"
20 PRINT CHR$(205.5 + RND(1));
40 GOTO 20
```

运行时，上面的程序会生成一个随机迷宫：

![Commodore 64 maze program](https://twobithistory.org/images/c64_maze.gif)

图 6: 康懋达 64 迷宫程序

这绝对是你见过的最酷的东西。

## PEEK 和 POKE

你现在已经读完了康懋达 64 手册的前四章，包括名为“高级 BASIC”的章节，所以你感到非常自豪。这个周六早上你学到了很多。但今天下午 (快速午餐后)，你将学到一些东西，这将使你客厅里这台神奇的机器不那么神秘。

手册的下一章标题是“高级颜色和图形命令”。它首先回顾了你今天早上第一时间就能输入的彩色条纹，并向你展示了如何从程序中实现同样的效果。然后它教你如何改变屏幕的背景颜色。

为了做到这一点，你需要使用 BASIC 的 `PEEK` (PEEK) 和 `POKE` (POKE) 命令。这些命令分别用于检查和写入内存地址 (memory address)。康懋达 64 有一个主背景色和一个边框色。每个都由一个特殊指定的内存地址控制。你可以将任何颜色值写入这些地址，使背景或边框变成那种颜色。

手册解释道：

> 就像变量可以被认为是机器内部存储你信息的“盒子”一样，你也可以把计算机内部一些特殊定义的“盒子”看作是特定的内存位置。
>
> 康懋达 64 会查看这些内存位置，以确定屏幕的背景色和边框色应该是什么，屏幕上应该显示哪些字符以及在哪里显示，以及许多其他任务。

你编写了一个程序来循环显示所有可用的背景色和边框色组合：

```
10 FOR BA = 0 TO 15
20 FOR BO = 0 TO 15
30 POKE 53280, BA
40 POKE 53281, BO
50 FOR X = 1 TO 500 : NEXT X
60 NEXT BO : NEXT BA
```

虽然 `POKE` 命令及其大操作数一开始看起来很吓人，但现在你明白数字的实际值并没有那么重要。显然，你必须把数字写对，但这个数字所代表的，只是康懋达碰巧存储在地址 53280 的一个“盒子”。这个盒子有一个特殊用途：康懋达用它来决定屏幕背景应该是什么颜色。

![Commodore 64 changing background colors](https://twobithistory.org/images/c64_background.gif)

图 7: 康懋达 64 改变背景颜色

你觉得这相当酷。仅仅通过向内存中一个特殊用途的“盒子”写入数据，你就可以控制计算机的一个基本属性。你不确定康懋达 64 的电路 (circuitry) 如何将你写入内存的值转换为屏幕上的颜色变化，但你不了解也没关系。至少你理解了到那一点为止的所有内容。

## 特殊的盒子

那个周六你并没有读完整个手册，因为你现在开始筋疲力尽了。但你最终还是读完了所有内容。在这个过程中，你了解了康懋达 64 更多特殊用途的“盒子”。有些盒子你可以写入来控制屏幕上显示的内容——事实上，每个字符可能出现的位置都有一个盒子。在第六章“精灵图 (Sprite Graphics)”中，你了解了那些允许你定义可以移动、甚至放大缩小的图像的特殊用途盒子。在第七章“创建声音”中，你了解了那些你可以写入以让你的康懋达 64 唱起《迈克尔划船上岸》的盒子。事实证明，康懋达 64 几乎没有你后来会学到的所谓应用程序编程接口 (API) 的东西。控制康懋达 64 主要涉及向那些被电路赋予特殊含义的内存地址写入数据。

你最终花费多年时间向那些特殊盒子写入数据的经历将伴随你。即使几十年后，当你发现自己正在编程一台拥有功能丰富的图形或声音 API 的机器时，你也知道，在幕后，API 最终都在向那些“盒子”或类似的东西写入数据。你有时会想那些只使用过 API 的年轻程序员，并想知道他们会认为 API 为他们做了什么。也许他们认为 API 调用了其他隐藏的 API。但他们又会认为那个隐藏的 API 调用了什么呢？你会怜悯那些年轻的程序员，因为他们确实会非常困惑。

如果你喜欢这篇文章，每四周都会有更多类似的文章发布！在 Twitter 上关注 [@TwoBitHistory](https://twitter.com/TwoBitHistory) 或订阅 [RSS 源](https://twobithistory.org/feed.xml)，确保你不会错过任何新文章。

TwoBitHistory 往期回顾…

> 你有没有想过，19 世纪的计算机程序翻译成 C 语言会是什么样子？
>
> 本周文章：详细解读 Ada Lovelace 著名程序的运作方式及其目的。<https://t.co/BizR2Zu7nt>
>
> — TwoBitHistory (@TwoBitHistory) [2018 年 8 月 19 日](https://twitter.com/TwoBitHistory/status/1030974776821665793?ref_src=twsrc%5Etfw)